<!-- If id is not exists then display message -->
<div class="flexlayout" *ngIf="!productSkuForm && !isInitialLoading && hasPermission">
    <div class="form_wrapper">
        <div id="no-access-form">
            <div class="top">
                <img src="assets/images/default/NoAccessImage.png" class="mb-3" alt="">
                <div class="subtitle mt-0">{{ 'PRODUCTSKU.DETAIL.MESSAGE_PRODUCTSKU_NOT_EXISTS' | translate |
                    configuredEntityName}}
                </div>
            </div>
        </div>
    </div>
</div>
<div class="page-containted detail-productSku" *ngIf="isLoaded && productSkuForm && hasPermission">
    <!-- Header Start-->
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 mb-10px">
                <div class="detail-header h-100">
                    <div class="page-content card border-0 mb-0 h-100">
                        <div class="card-body p-card">
                            <div class="row vertical-center h-100">
                                <div class="col-xl col-lg-5 col-md-12 mb-3 mb-lg-0 mb-sm-4 d-flex align-self-start">
                                    <div class="float-left text-center">
                                        <div id="entity-icon" class="entity-icon">
                                            <i class="fas fa-receipt" aria-hidden="true"></i>
                                        </div>
                                    </div>
                                    <div class="stage-details float-start">
                                        <p class="m-0">
                                            <span class="card-title mb-1">
                                                <label id="headingEntity">{{ 'PRODUCTSKU.DETAIL.TITLE' | translate |
                                                    configuredEntityName }}</label>
                                                <div class="overflow-box">
                                                    <strong id="nameEntity"
                                                        class="pre-text">{{copyOfProductSku.name}}</strong>
                                                </div>
                                                <div>
                                                    <span id="entityRating" class="mt-2 h-21 mr-2 vertical-center">
                                                        <entity-review-display [entityTypeId]="entityTypeId" [entityId]="productSkuId" [isFromKanbanOrListView]="false"
                                                            [isEditPermission]="isEditProductSku">
                                                        </entity-review-display>
                                                    </span>
                                                    <span *ngIf="productSku.entityRecordTypeName!=null"
                                                        class="mt-2 mb-2 h-21 badge badge-primary badge--status mr-2"
                                                        id="badgeEntityRecordType">
                                                        {{productSku.entityRecordTypeName}}
                                                    </span>
                                                    <span id="badgeActiveInactive"
                                                        [ngClass]="productSku.isActive == true ? 'bg-primary' : 'bg-danger'"
                                                        class="mt-2 h-21 badge badge--status">
                                                        {{ productSku.isActive | active }}
                                                    </span>
                                                </div>
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-xl-6 col-lg details-section col-md-12 align-self-start">
                                    <div class="row">
                                        <div
                                            class="col-xl col-lg-6 col-md-6 col-sm-6 mb-xl-0 mb-lg-3 mb-md-0 mb-sm-3 mb-1 header-value col-header">
                                            <div class="row">
                                                <div class="col-sm-12 col-header-label col-created-label">
                                                    <label>{{ 'PRODUCTSKU.DETAIL.HEADER_CREATED' | translate}}</label>
                                                </div>
                                                <div class="col-sm-12 col">
                                                    <p class="m-0" id="lblCreatedDate">
                                                        {{productSku.created | date:'medium' }}
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="row mt-1 mt-sm-2 col-header">
                                                <div class="col-sm-12 col-header-label col-created-label">
                                                    <label>{{ 'PRODUCTSKU.DETAIL.HEADER_CREATED_BY' |
                                                        translate}}</label>
                                                </div>
                                                <div class="col-sm-12 col">
                                                    <p class="m-0">
                                                        {{productSku.createdByName}}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div
                                            class="col-xl col-lg-6 col-md-6 col-sm-6 mb-xl-0 mb-lg-3 mb-md-0 mb-sm-3 mb-1 header-value col-header">
                                            <div class="row">
                                                <div class="col-sm-12 col-header-label">
                                                    <label>{{ 'PRODUCTSKU.DETAIL.HEADER_UPDATED' | translate}}</label>
                                                </div>
                                                <div class="col-sm-12 col">
                                                    <p class="m-0">
                                                        {{productSku.modified | date:'medium' }}
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="row mt-1 mt-sm-2 col-header">
                                                <div class="col-sm-12 col-header-label">
                                                    <label>{{ 'PRODUCTSKU.DETAIL.HEADER_UPDATED_BY' |
                                                        translate}}</label>
                                                </div>
                                                <div class="col-sm-12 col">
                                                    <p class="m-0">
                                                        {{productSku.modifiedByName}}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="back-arrow col-lg">
                                    <div class="row">
                                        <div class="col-12">
                                            <button id="btn-back" class='btn btn-secondary mb-12px' type='button'
                                                (click)="onbackClick()">
                                                {{ 'PRODUCTSKU.DETAIL.BUTTON_BACK' | translate }}
                                            </button>
                                        </div>
                                        <div *ngIf="isEditProductSku" class="col-12">
                                            <div class="dropdown">
                                                <button class="btn btn-primary dropdown-toggle btn-action" type="button"
                                                    id="dropdownActionMenu" data-bs-toggle="dropdown"
                                                    aria-expanded="false">
                                                    {{ 'PRODUCTSKU.DETAIL.BUTTON_ACTION' | translate }}
                                                </button>
                                                <div class="dropdown-menu" aria-labelledby="dropdownActionMenu">
                                                    <a id="link-change-status" (click)="onActionChangeStatus()"
                                                        class="dropdown-item menu--item">
                                                        <i class="fas fa-toggle-on" aria-hidden="true"></i>
                                                        {{ 'PRODUCTSKU.DETAIL.ACTION_TITLE_CHANGESTATUS' | translate }}
                                                    </a>
                                                    <a *ngIf="isDeleteProductSku" id="link-delete" (click)="onDeleteProductSku(productSku.id)"
                                                        class="dropdown-item menu--item">
                                                        <i class="far fa-trash-alt me-1" aria-hidden="true"></i>
                                                        {{'PRODUCTSKU.DETAIL.ACTION_TITLE_DELETE' | translate }}
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 align-self-end align-tags">
                                    <entity-tags-view [refreshEntityTag]="refreshEntityTag" [entityId]="productSkuId"
                                        [entityTypeId]="entityTypeId" [entityRecordTypeId]="entityRecordTypeId">
                                    </entity-tags-view>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Header End-->

    <!-- Body Start-->
    <div class="page-content container-fluid pr-0">
        <div class="row h---100vh w-100">
            <div class="col col-xl-8 col-lg-12 mb-xl-0 mb-2 pr-0 details-box">
                <!-- nav Tab Menu Start -->
                <div class="navTabs card-bottom-border border-0 p-card">
                    <div class="row width--100 border-bottom m-0 first-tabs">
                        <!-- Tab Section here -->
                        <ng-container>
                            <ngx-globle-nav-tab [navTabs]="navTabs" [isNativeTab]="isNativeTab"
                                (setTab)="checkTabCall($event,1)" class="col tabs-mobile p-0" (closeTab)="closeNavTab($event)"
                                [ngClass]="{'edit-icon-section': isReadOnly && !(['navWorkTasks', 'navContacts', 'navStagePauseHistory', 'navAttachment', 'navProducts', 'navStageHistory', 'additionalTabs','navDocuments'] | showHidePencilButton: activeTab)}"></ngx-globle-nav-tab>
                        </ng-container>
                        <div class="col-auto edit-form-icon px-0">
                            <div *ngIf="isEditProductSku && productSku.isActive">
                                <i class="fas fa-pencil-alt pencil-icon fa-lg clr-blue float-right cursor-pointer"
                                    id="btnEditTabDetail" (click)="showHideDetailTab('EDIT')"
                                    *ngIf="isReadOnly && !(['navRelatedProducts', 'navAssemblies','navHistory', 'additionalTabs','navDocuments'] | showHidePencilButton: activeTab)"
                                    aria-hidden="true"></i>
                            </div>
                            <!-- Global save and cancel start -->
                            <div class="form-update-icons"
                                *ngIf="!isReadOnly && !(['navRelatedProducts', 'navAssemblies', 'navHistory', 'additionalTabs','navDocuments'] | showHidePencilButton: activeTab)">
                                <i id="btn-cancel" *ngIf="isEditProductSku && productSku.isActive"
                                    class="fas fa-times fa-lg dark-grey float-right mr-3"
                                    (click)="showHideDetailTab('CANCEL')" aria-hidden="true"></i>
                                <i *ngIf="isEditProductSku && productSku.isActive" id="btn-save"
                                    class="fas fa-check fa-lg clr-blue float-right"
                                    (click)="showHideDetailTab('SAVE')" aria-hidden="true"></i>
                            </div>
                            <!-- Global save and cancel end -->
                        </div>
                    </div>

                    <!-- Tab Content Start -->
                    <form [hidden]="isAdditionalTab" [formGroup]="productSkuForm">
                        <div class="tab-content border-0 mt-0" id="productSkuDetailTabContent">
                            <!-- Details Start-->
                            <div class="tab-pane fade px-0 p-0" id="navDetails" role="tabpanel"
                                [ngClass]="selectedTab == 'navDetails' ? 'show active' : ''"
                                aria-labelledby="navDetails-tab" name="navDetails">

                                <!-- Basic Information Start-->
                                <div class="card border-0 m-0 pt-md-0 pt-3">
                                    <div class="card-header btn-card-edit py-0">
                                        <span class="vertical-center py-md-3 pt-0 pb-3 line-height-1">{{
                                            'PRODUCTSKU.DETAIL.TAB_DETAILS.BASIC_INFO' | translate }}</span>
                                    </div>
                                    <div class='card-body'>
                                        <div class='row'>
                                            <div class='col-xl-4 col-sm-6 form-group'>
                                                <label>{{ 'PRODUCTSKU.DETAIL.TAB_DETAILS.NAME' | translate }}<span
                                                        class="mandatory"></span></label>
                                                <div *ngIf="isReadOnly" class="disable-text pre-text">{{ productSku.name
                                                    ? productSku.name : '&nbsp;' }}</div>
                                                <input #skuTxtName *ngIf="!isReadOnly" id="txt-name" type="text"
                                                    class="form-control" formControlName="name"
                                                    [(ngModel)]="productSku.name" trimValue
                                                    [ngClass]="{ 'is-invalid': productSkufrm.name.errors && (productSkufrm.name.dirty || productSkufrm.name.touched)}"
                                                    trimValue>
                                                <div *ngFor='let validation of productSkuValidationMessages.name'
                                                    class='invalid-feedback'>
                                                    <div *ngIf='productSkufrm.name.hasError(validation.type) && productSkufrm.name.errors && (productSkufrm.name.dirty || productSkufrm.name.touched)'
                                                        id="errorNameIsRequired">
                                                        {{ validation.message | translate }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class='col-xl-4 col-sm-6 form-group'>
                                                <label>{{ 'PRODUCTSKU.DETAIL.TAB_DETAILS.SKU' | translate }}<span
                                                        class="mandatory"></span></label>
                                                <div *ngIf="isReadOnly" class="disable-text pre-text">{{ productSku.sku
                                                    ? productSku.sku : '&nbsp;' }}</div>
                                                <input *ngIf="!isReadOnly" id="txt-Sku" type="text" class="form-control"
                                                    formControlName="sku" [(ngModel)]="productSku.sku" trimValue
                                                    [ngClass]="{ 'is-invalid': productSkufrm.sku.errors && (productSkufrm.sku.dirty || productSkufrm.sku.touched)}"
                                                    trimValue>
                                                <div *ngFor='let validation of productSkuValidationMessages.sku'
                                                    class='invalid-feedback'>
                                                    <div *ngIf='productSkufrm.sku.hasError(validation.type) && productSkufrm.sku.errors && (productSkufrm.sku.dirty || productSkufrm.sku.touched)'
                                                        id="errorSkuIsRequired">
                                                        {{ validation.message | translate }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-4 col-sm-6 form-group">
                                                <label>{{'PRODUCTSKU.DETAIL.TAB_DETAILS.UOM' | translate}}</label>
                                                <i class="fas fa-info-circle dark-grey ml-1 info-tooltip" ngbTooltip="Unit Of Measurement" placement="top top-left" container="body" aria-hidden="true"></i>
                                                <div class="inner-addon">
                                                    <div *ngIf="isReadOnly" class="disable-text">
                                                        {{productSku.uomName}}
                                                    </div>
                                                </div>
                                                <div *ngIf="!isReadOnly">
                                                    <ngx-control-level-loading-bar *ngIf="showUOMLoader"></ngx-control-level-loading-bar>
                                                    <p-dropdown id="drp-uom" name="uomid" formControlName="uomid"
                                                        [options]="groupedUOMTypes" optionLabel="label"  filterBy="label,groupLabel"
                                                        optionValue="value" [group]="true" class="form-control"
                                                        placeholder="{{'PRODUCTSKU.DETAIL.TAB_DETAILS.UOM_PLACEHOLDER' | translate}}"
                                                        [filter]="true" [resetFilterOnHide]="false" [showClear]="true"
                                                        (onChange)="onUOMSelectionChange($event.value)"
                                                        [(ngModel)]="productSku.uomid">
                                                        <ng-template let-group pTemplate="group">
                                                            {{group.label}}
                                                        </ng-template>
                                                        <ng-template let-item pTemplate="item">
                                                            <span>{{item.label}}</span>
                                                        </ng-template>
                                                    </p-dropdown>
                                                </div>
                                            </div>
                                            <div class='col-xl-4 col-sm-6 form-group'>
                                                <label>{{'PRODUCTSKU.DETAIL.TAB_DETAILS.PRICE' | translate}}</label>
                                                <div class="inner-addon left-addon">
                                                    <div *ngIf="isReadOnly" class="disable-text">
                                                        <div *ngIf="(productSku.price != null ) else blankprice">
                                                            {{(currencySymbol)+(productSku.price | number:'1.2-2') }}
                                                        </div>
                                                        <ng-template #blankprice>
                                                            <div>&nbsp;</div>
                                                        </ng-template>
                                                    </div>
                                                </div>
                                                <div class="inner-addon left-addon" *ngIf="!isReadOnly">
                                                    <span>{{currencySymbol}}</span>
                                                    <input id="txt-price" type="text" class="form-control ht--40"
                                                        name="price" maxlength="18" formControlName="price"
                                                        [(ngModel)]="productSku.price" mask="separator.2"
                                                        thousandSeparator=","
                                                        [ngClass]="{ 'is-invalid': productSkufrm.price.errors && (productSkufrm.price.dirty || productSkufrm.price.touched)}">
                                                    <div *ngFor='let validation of productSkuValidationMessages.price'
                                                        class='invalid-feedback'>
                                                        <div *ngIf='productSkufrm.price.hasError(validation.type) && productSkufrm.price.errors && (productSkufrm.price.dirty || productSkufrm.price.touched)'
                                                            id="errorPriceMustBeValidNumber">
                                                            {{ validation.message | translate }}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class='col-xl-4 col-sm-6 form-group'>
                                                <label>
                                                    {{ 'PRODUCTSKU.DETAIL.TAB_DETAILS.STOCKQTY' | translate }}
                                                </label>
                                                <div *ngIf="isReadOnly" class="disable-text">
                                                    {{ productSku.stockQty ? (productSku.stockQty | number:'1.3-3'):
                                                    '&nbsp;' }}
                                                </div>
                                                <input *ngIf="!isReadOnly" id="txt-stockQty" type="text"
                                                    class="form-control ht--40" name="stockQty" maxlength="18"
                                                    formControlName="stockQty" [(ngModel)]="productSku.stockQty"
                                                    trimValue mask="separator.3" thousandSeparator=","
                                                    [ngClass]="{ 'is-invalid': productSkufrm.stockQty.errors && (productSkufrm.stockQty.dirty || productSkufrm.stockQty.touched)}">
                                                <div *ngFor='let validation of productSkuValidationMessages.stockQty'
                                                    class='invalid-feedback'>
                                                    <div *ngIf='productSkufrm.stockQty.hasError(validation.type) && productSkufrm.stockQty.errors && (productSkufrm.stockQty.dirty || productSkufrm.stockQty.touched)'>
                                                        {{validation.message | translate }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Details End-->

                            <!-- History tab start  -->
                            <div class="tab-pane fade" id="navHistory" role="tabpanel" [ngClass]="selectedTab == 'navHistory' ? 'show active' : ''"
                                aria-labelledby="navHistory-tab" name="navHistory">
                                <ng-container *ngIf="onceStageHistoryClicked">
                                    <ngx-history-tab [entityTypeId]="entityTypeId" [entityId]="productSkuId"
                                        [refreshStageHistory]="refreshStageHistory" [refreshActivityHistory]="refreshActivityHistory"></ngx-history-tab>
                                </ng-container>
                            </div>
                            <!-- History tab end  -->

                            <!-- Custom Start-->
                            <div class="tab-pane fade px-0 pt-0"
                                [ngClass]="selectedTab == ('nav' + tab.tabName | removeWhiteSpace) ? 'show active' : ''"
                                *ngFor="let tab of formDataJSON; let i = index"
                                id="{{ 'nav' + tab.tabName | removeWhiteSpace }}" name="navCustom" role="tabpanel"
                                aria-labelledby="navCustom-tab">
                                <!-- Section Start-->
                                <div class='card border-0 m-0 pt-md-0 pt-3'
                                    *ngFor="let section of tab.sections; let j = index">
                                    <div class="card-header btn-card-edit py-0">
                                        <span *ngIf="section.sectionName"
                                            class="vertical-center py-md-3 pt-0 pb-3 line-height-1">
                                            {{ section.sectionName }}
                                        </span>
                                    </div>
                                    <div class='card-body'>
                                        <div class='row'>
                                            <ngx-custom-field [formGroup]="productSkuForm" [section]="section"
                                                [controls]="section.controls"
                                                [customFieldJSONData]="productSku.customFieldJSONData"
                                                [isReadOnly]="isReadOnly" [submitted]="submitted"
                                                [currencySymbol]="currencySymbol"
                                                [refreshTabularDataSource]="refreshCustomFieldDatasource"
                                                [entityID]="productSkuId" [entityTypeID]="entityTypeId"
                                                [entityRecordTypeID]="entityRecordTypeId"></ngx-custom-field>
                                        </div>
                                    </div>
                                </div>
                                <!-- Section End-->
                            </div>
                            <!-- Custom End-->

                            <!-- Product Sku Assemblies Start-->
                            <ng-container *ngIf="onceAssembliesClicked">
                                <div class="tab-pane fade p-3 search-wrapper" id="navAssemblies" role="tabpanel"
                                    [ngClass]="selectedTab == 'navAssemblies' ? 'show active' : ''"
                                    aria-labelledby="navAssemblies-tab" name="navAssemblies">
                                    <div *ngIf="isEditProductSku && productSku.isActive"
                                        class="mb-3 vertical-center justify-content-end dropdown-with-add">
                                        <button type="button" id="btn-add-sku" class="btn btn-primary ml-3"
                                            (click)="openAddSKUPopup()">
                                            <i class="fa fa-plus-circle me-1" aria-hidden="true"></i>
                                            {{'PRODUCTSKU.DETAIL.TAB_ASSEMBLIES.BUTTON_ADD' | translate |
                                            configuredEntityName}}
                                        </button>
                                    </div>
                                    <div class="table-responsive">
                                        <app-dynamic-table *ngIf="refreshAssemblyList" [code]="'PRODUCT_SKU_ASSEMBLIES'"
                                            [parameters]="tbSkuAssembliesParameters"
                                            (onDeleteClick)="deleteProductSkuAssembly($event)"
                                            (onEditClick)="editProductSkuAssembly($event)">
                                        </app-dynamic-table>
                                    </div>
                                </div>
                            </ng-container>
                            <!-- Product Sku Assemblies End-->

                            <!-- Document Start-->
                            <div class="tab-pane fade p-3 search-wrapper" id="navDocuments" role="tabpanel"
                                [ngClass]="selectedTab == 'navDocuments' ? 'show active' : ''" aria-labelledby="navDocuments-tab"
                                name="navDocuments">
                                <ng-container *ngIf="onceDocumentClicked">
                                    <ngx-entity-documents [entityID]="productSkuId" class="entity-documents" [entityTypeID]="entityTypeId"
                                        [isDocumentDownloadPermission]="isDocumentDownloadPermission && productSku.isActive"
                                        [isEditPermission]="isEditProductSku && productSku.isActive"
                                        [refreshFromParent]="refreshActivityHistory"
                                        (refreshDocuments)="setRefreshDocument()">
                                    </ngx-entity-documents>
                                </ng-container>
                            </div>
                            <!-- Document End-->
                        </div>
                    </form>
                    <!-- Tab Content END -->
                    <div *ngIf="isAdditionalTab">
                        <!-- Tab Additional here -->
                        <ng-container>
                            <ngx-globle-nav-tab [isNativeTab]="isNativeTab" [isAdditionalTab]="isAdditionalTab"
                                [navTabs]="navTabsMore" (setTab)="checkTabCall($event,0)" class="col-12 p-0" (closeTab)="closeNavTab($event)"
                                [ngClass]="{'edit-icon-section': isReadOnly && !(['navWorkTasks', 'navContacts', 'navStagePauseHistory', 'navAttachment', 'navProducts', 'navStageHistory', 'additionalTabs','navDocuments'] | showHidePencilButton: activeTab)}"></ngx-globle-nav-tab>
                        </ng-container>
                    </div>
                    <!-- Tab Other Tabs Link -->
                </div>
            </div>
            <activity-section 
                [entityTypeId]="entityTypeId" 
                [entityId]="productSkuId" 
                [isTagRequired]="true"
                [isEditPermission]="isEditProductSku"
                [isActive]="productSku.isActive"
                [isDocumentRequired]="true"
                [refreshDocument]="refreshDocument"
                [refreshActivity]="refreshActivity" 
                [entityRecordTypeId]="entityRecordTypeId"
                [isDocumentDownloadPermission]="isDocumentDownloadPermission && productSku.isActive"
                (isTagListUpdated)="setRefreshEntityTag()" 
                class="col-xl-4 col-md-12 common-box pr-0"
                (isActivityListUpdated)="setRefreshActivityHistory()" 
                [createdBy]="productSku?.createdBy"
                [privacyLevel]="null">
            </activity-section>
        </div>
    </div>
    <!-- Body End-->
</div>