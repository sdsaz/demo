<div class="position-relative w-100 h-100">
    <div id="activity-loader" class="widget-loader" *ngIf="showLoadingPanel > 0">
        <div class="bounce-spinner">
            <div class="bounce1"></div>
            <div class="bounce2"></div>
            <div class="bounce3"></div>
        </div>
    </div>
    <!-- Start Empty Template Message -->
    <ng-template #emptyTemplate>
        <div class="bg-timeline p-card d-flex justify-content-center align-items-center flex-wrap" id="emptyTemplate">
            <div class=" d-flex justify-content-center align-items-center flex-wrap">
                <div class="icon-select mb-2"></div>
                <div class="w-100 text-center"><h6 class="mb-0">{{'COMMON_DETAILS_TAB.EMPTY_TEMPLATE_MESSAGE' | translate}}</h6></div>
            </div>
        </div>
    </ng-template>
    <!-- End Empty Template Message -->
    <ng-container *ngIf="(entityId && entityId > 0) else emptyTemplate">
        <div *ngIf="!hideExpandButton" id="btn-openActivity" class="display-activity-icon sticky-tab">
            <button class="p-button-rounded p-button-sm btn-activity" (click)="openActivity()">
                <i class="pi pi-angle-left" id="iconOpenActivity" aria-hidden="true"></i>
            </button>
        </div>
        <div class="sideActivity" id="sideActivity">
            <!-- start activity panel-->
            <!-- start nav tab menu -->
            <div class="bg-timeline p-card">
                <div class="navTabs border-0 activity-section">
                    <div class="tabs-mobile main-tabs">
                        <ul class="nav nav-tabs nav-border font-12" role="tablist">
                            <li *ngIf="!isHideDetailsTab" class="nav-item">
                                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#mainDetails"
                                    type="button" role="tab" aria-controls="mainDetails" aria-selected="true"
                                    id="mainDetails-tab" (click)="setTab('mainDetails')">
                                    <i aria-hidden="true" class="fa-solid fa-file-lines mr-1"></i>
                                    {{'COMMON_DETAILS_TAB.TITLE' | translate}}
                                </button>
                            </li>
                            <li *ngIf="!isHideActivityTab" class="nav-item">
                                <button [ngClass]="isHideDetailsTab ? 'nav-link active' : 'nav-link'" data-bs-toggle="tab"
                                    data-bs-target="#mainActivity" type="button" role="tab" aria-controls="mainActivity"
                                    aria-selected="true" id="mainActivity-tab" (click)="setTab('mainActivity')">
                                    <i aria-hidden="true" class="fa fa-list-ol mr-1"></i> {{'ACTIVITY.TITLE' | translate}}
                                </button>
                            </li>
                            <li *ngIf="!isHideDocumentTab" class="nav-item">
                                <button [ngClass]="isHideDetailsTab && isHideActivityTab ? 'nav-link active' : 'nav-link'"
                                    class="nav-link" data-bs-toggle="tab" data-bs-target="#documents" type="button"
                                    role="tab" aria-controls="documents" aria-selected="true" id="document-tab"
                                    (click)="setTab('documents')">
                                    <i aria-hidden="true" class="fas fa-folder-open mr-1"></i> {{'DOCUMENTS.TITLE' |
                                    translate}}
                                    {{onceDocumentTabClicked ? ('(' + documentTotalRecords + ')') : ''}}
                                </button>
                            </li>
                        </ul>
                        <button *ngIf="!hideExpandButton" id="btn-closeActivity"
                            class="closebtn btn-activity display-activity-icon sticky-tab" (click)="closeActivity()">
                            <i class="pi pi-angle-right" aria-hidden="true"></i>
                        </button>
                        <button *ngIf="hideExpandButton" type="button" class="btn btn-close-quickView border-0 bg-transparent dark-grey" id="btn-close-quickView" (click)="onActivitySectionClose()">
                            <i class="fas fa-times fa-lg" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div class="tab-content border-0 mt-0 navs-boreder h-100-p tabs-top-spacing">
                        <!-- start-details-section -->
                        <div *ngIf="!isHideDetailsTab" aria-labelledby="mainDetails"
                            class="show active tab-pane tab-pane-details  fade p-0 h-100-p" id="mainDetails" role="tabpanel"
                            name="mainActivity">
                            <ngx-common-details-section class="tabs-mobile sub-tabs" 
                                [entityDetailsData]="entityDetailsData"
                                [entityTypeId]="entityTypeId"
                                [entityRecordTypeId]="entityRecordTypeId"
                                [entityId]="entityId"
                                [isEditPermission]="isEditPermission"
                                [isActive]="isActive"
                                [isPaused]="isPaused"
                                [isDefault]="isDefault"
                                [isClosedStage]="isClosedStage"                                
                                [isCompletedStage]="isCompletedStage"
                                [keyfieldResponseData]="keyfieldResponseData" 
                                [currencySymbol]="currencySymbol" 
                                [hoursInDay]="hoursInDay"
                                (onEntityStagesTasks)="onEntityStagesTasksClick($event)" 
                                (onShowLoader)="showLoader()"
                                (saveKeyFieldEvent)="onSaveKeyFieldEvent($event)" 
                                [showSubTaskCreateOption]="showSubTaskCreateOption"
                                [showLinkWorkTaskCreateOption]="showLinkWorkTaskCreateOption"
                                [addWorkTaskCreateOption]="addWorkTaskCreateOption"
                                [isAddOpportunity]="isAddOpportunity"
                                [isAddCase]="isAddCase"
                                [isAddWorkTask]="isAddWorkTask"
                                [isAddSubWorkTask]="isAddSubWorkTask"
                                [isFromKanbanOrListView]="isFromKanbanOrListView"
                                (onHideLoader)="hideLoader()" 
                                (onSubTaskCreate)="onClickSubTaskCreate($event)" 
                                (onLinkWorkTaskCreate)="onClickLinkWorkTaskCreate($event)"
                                (onAddWorkTask)="onClickAddWorkTaskCreate($event)"
                                (onAddOpportunity)="onAddOpportunityCreate($event)"
                                (onAddCase)="onAddCaseCreate($event)"
                                (raiseHandChange)="onRaiseHandChangeEvent($event)"
                                (pauseOrResumeChanges)="onPauseOrResumeChangesEvent($event)">
                            </ngx-common-details-section>
                        </div>
                        <!-- End-details-section -->

                        <!-- start activity -->
                        <ng-container *ngIf="!isHideActivityTab && onceActivityTabClicked">
                            <div aria-labelledby="mainActivity" class="tab-pane fade p-0 h-100-p" id="mainActivity"
                                role="tabpanel" [ngClass]="activeTab === 'mainActivity' ? 'show active': ''"
                                name="mainActivity">
                                <div class="navTabs h-100-p border-0">
                                    <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault && ( !isHideTasksTab || !isHideNotesTab || !isHideAppointmentsTab  || !isHideTagsTab || !isHideEntityReviewsTab)"
                                        class="tabs-mobile sub-tabs">
                                        <ul class="nav nav-tabs nav-brdr-grey font-12 mx-3 activity-tab" id="activityTab" role="tablist">

                                            <li *ngIf="!isHideTasksTab" class="nav-item">
                                                <button [ngClass]="'nav-link active'" data-bs-toggle="tab"
                                                    data-bs-target="#navActivity" (click)="onClickActivityTab()"
                                                    type="button" role="tab" aria-controls="navActivity"
                                                    aria-selected="true" id="navActivity-tab">
                                                    <i aria-hidden="true" class="fas fa-phone-alt mr-1"></i> Tasks
                                                </button>
                                            </li>
                                            <li *ngIf="!isHideNotesTab" class="nav-item">
                                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#navNotes"
                                                    (click)="onClickActivityTab()" type="button" role="tab"
                                                    aria-controls="navNotes" aria-selected="true" id="navNotes-tab">
                                                    <i aria-hidden="true" class="far fa-file mr-1"></i> Notes
                                                </button>
                                            </li>
                                            <li *ngIf="!isHideAppointmentsTab" class="nav-item">
                                                <button class="nav-link" data-bs-toggle="tab"
                                                    data-bs-target="#navAppointments" (click)="onClickActivityTab()"
                                                    type="button" role="tab" aria-controls="navAppointments"
                                                    aria-selected="true" id="navAppointments-tab">
                                                    <i aria-hidden="true" class="fas fa-calendar-alt mr-1"></i> Appointments
                                                </button>
                                            </li>
                                            <li *ngIf="!isHideTagsTab" class="nav-item">
                                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#navLogs"
                                                    (click)="onClickActivityTab()" type="button" role="tab"
                                                    aria-controls="navLogs" aria-selected="true" id="navLogs-tab">
                                                    <i aria-hidden="true" class="fas fa-user-tag mr-1"></i> Tags
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="tab-content border-0 mt-0 navs-boreder h-100-p px-3 border--tab"
                                        id="activityTabContent">
                                        <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault && !isHideTasksTab" aria-labelledby="navActivity-tab"
                                            class="tab-pane content-tabs fade show active h-100-p" id="navActivity"
                                            role="tabpanel">
                                            <div class="pb-3 vertical-center flex-nowrap">
                                                <div class="width--100">
                                                    <p-dropdown #activityDropdown="ngModel" id="drp-activity-tasks"
                                                        class="form-control" [options]="activityOptions"
                                                        [ngClass]="{ errorborder: activityDropdown.invalid && isActivitySubmitted}"
                                                        placeholder="{{'ACTIVITY.TASKS.PLACEHOLDER' | translate}}"
                                                        [(ngModel)]="activitySelected" optionLabel="name" required>
                                                    </p-dropdown>
                                                </div>
                                                <button type="button" id="btn-add-task"
                                                    (click)="openActivityTaskDialog('ACTIVITY')"
                                                    class="btn btn-primary btn-small float-right ml-3">
                                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault && !isHideNotesTab" aria-labelledby="navNotes-tab"
                                            class="tab-pane content-tabs fade" id="navNotes" role="tabpanel"
                                            [ngClass]="isHideTasksTab && !isHideNotesTab && isHideAppointmentsTab && isHideTagsTab && isHideEntityReviewsTab ? 'show active': ''">
                                            <div class="pos_fixed">
                                                <div class="row px-3 pb-3">
                                                    <div class="col-lg-12 p-0">
                                                        <!-- Note Start -->
                                                        <ng-container *ngIf="noteNoteTypeId > 0">
                                                            <note-form (isNoteSubmittedToEmit)="getChildFormNote($event)"
                                                                [entityTypeId]="entityTypeId" [entityId]="entityId"
                                                                [entityRecordTypeID]="noteNoteTypeId">
                                                            </note-form>
                                                        </ng-container>
                                                        <!-- Note Call End -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault && !isHideAppointmentsTab"
                                            aria-labelledby="navAppointments-tab" class="tab-pane content-tabs fade "
                                            id="navAppointments" role="tabpanel"
                                            [ngClass]="isHideTasksTab && isHideNotesTab && !isHideAppointmentsTab && isHideTagsTab && isHideEntityReviewsTab ? 'show active': ''">
                                            <div class="pb-3 vertical-center flex-nowrap">
                                                <div class="width--100">
                                                    <input #appointmentSubject="ngModel" type="text"
                                                        id="txt-activity-appointment" [(ngModel)]="appointmentSubjectName"
                                                        class="form-control" title="" 
                                                        placeholder="{{'ACTIVITY.APPOINTMENTS.PLACEHOLDER' | translate}}"
                                                        [ngClass]="{ 'border border-danger': appointmentSubject.invalid && isActivitySubmitted }"
                                                        required trimValue>
                                                </div>
                                                <button class='btn btn-primary btn-small float-right ml-3'
                                                    id="btn-add-appointment" type='button'
                                                    (click)="openActivityTaskDialog('MEETING')">
                                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault && !isHideTagsTab" aria-labelledby="navLogs-tab"
                                            class="tab-pane content-tabs fade" id="navLogs" role="tabpanel"
                                            [ngClass]="isHideTasksTab && isHideNotesTab && isHideAppointmentsTab && !isHideTagsTab && isHideEntityReviewsTab ? 'show active': ''">
                                            <div class="pb-3 vertical-center flex-nowrap">
                                                <div class="width--dropdown tag-multiselect">
                                                    <p-multiSelect [options]="groupedTags" type="text"
                                                        id="drp-activity-tags" #tagText="ngModel" [(ngModel)]="tagName"
                                                        class="form-control tag-dropdown"
                                                        placeholder="{{'ACTIVITY.TAGS.PLACEHOLDER' | translate}}"
                                                        [ngClass]="{ 'errorborder': tagText.invalid && isActivitySubmitted }"
                                                        [group]="true" display="chip" [filter]="true"
                                                        [resetFilterOnHide]="false" filterBy="label,groupLabel"
                                                        [showToggleAll]="false" (onChange)="onTagSelectionChange($event)"
                                                        required>
                                                        <ng-template let-tag pTemplate="item">
                                                            <div class="entity-pad">
                                                                {{tag.label}}
                                                            </div>
                                                        </ng-template>
                                                    </p-multiSelect>
                                                </div>
                                                <button [disabled]="tagName.length <= 0" id="btn-add-tag"
                                                    class='btn btn-primary btn-small float-right ml-3' type='button'
                                                    (click)="setTag()">
                                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault && !isHideEntityReviewsTab"
                                            aria-labelledby="navEntityReviews-tab" class="tab-pane content-tabs fade "
                                            id="navEntityReviews" role="tabpanel"
                                            [ngClass]="isHideTasksTab && isHideNotesTab && isHideAppointmentsTab && isHideTagsTab ? 'show active': ''">
                                            <div class="pb-3 vertical-center flex-nowrap">
                                                <div class="width--100">
                                                    <p-rating id="rt-rating" class="form-control vertical-center rating-activity" [(ngModel)]="entityReviewRating" [cancel]="false"
                                                        [ngClass]="{ 'is-invalid': entityReviewRating == null && isActivitySubmitted }">
                                                    </p-rating>
                                                </div>
                                                <button class='btn btn-primary btn-small float-right ml-3'
                                                    [disabled]="entityReviewRating == null && isActivitySubmitted" id="btn-add-entityReview" type='button'
                                                    (click)="onAddEditEntityReview('Add')">
                                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="font-weight-bold font-12 py-3 width--100 title-activity-timeline">
                                            {{'ACTIVITY.ACTIVITY_TIMELIME' | translate}}
                                        </div>
                                        <div class="width--100 flex--center pb-3 filters-activity-timeline">
                                            <div class="d-flex flex-wrap">
                                                <div class="float-left width-filter margin-filter">
                                                    <p-dropdown appendTo="body" panelStyleClass="maxWidthOverride"
                                                        *ngIf="activityQuickFilterOptions && activityQuickFilterOptions.length > 0"
                                                        [options]="activityQuickFilterOptions" id="drp-activity-duration"
                                                        [(ngModel)]="activityQuickFilterSelected" optionLabel="name"
                                                        optionValue="strValue1" class="form-control"
                                                        (onChange)="loadActivityData(true)">
                                                    </p-dropdown>
                                                </div>
                                                <div class="float-left width-filter">
                                                    <p-dropdown [options]="filterTypeOptions" id="drp-activity-type"
                                                        appendTo="body" panelStyleClass="maxWidthOverride"
                                                        [(ngModel)]="filterTypeSelected" class="form-control"
                                                        optionLabel="name" (onChange)="loadActivityData(true)">
                                                    </p-dropdown>
                                                </div>
                                            </div>
                                            <span>
                                                <i class="fas fa-sync-alt fa-lg dark-grey cursor-pointer"
                                                    id="btn-refresh-activity" aria-hidden="true"
                                                    (click)="loadActivityData(true)"></i>
                                            </span>
                                        </div>
                                        <!-- Activity log Start-->
                                        <div class="ht-card ht--activity">
                                            <div class="card" id="log-activity" *ngFor="let item of activityDataSource">
                                                <div class="card-body d-flex p-3">
                                                    <div class="float-left w-100 pr-3">
                                                        <!-- start task status step 1 -->
                                                        <div *ngIf="item.activityType ==  entityEnum.Tasks">
                                                            <p class="font-12 mb-1">
                                                                <strong
                                                                    class="mb-1">{{getTaskLabel(item.entityRecordTypeID)}}</strong>
                                                                <span class="mb-1 h-23 badge clr-grey p-0 ml-3"
                                                                    *ngIf="item.modified"
                                                                    ngbTooltip=" {{item.modified==null?'':(item.modified | dateFormatPipe: _commonHelper.globalDateFormateWithTime)}} by {{item.modifiedByName}}"
                                                                    placement="top right" container="body"
                                                                    id="badgeActivityEdited">
                                                                    {{'ACTIVITY.TASKS.TASKS_EDITED_BADGE' | translate}}
                                                                    {{item.modified | timeAgoPipe : item.utcModified}}
                                                                </span>
                                                            </p>
                                                            <span class="m-0 gray-text font-12">{{'ACTIVITY.TASK_ON' |
                                                                translate}}:
                                                            </span>
                                                            <span class="font-12">{{item.activityDate | dateFormatPipe:
                                                                _commonHelper.globalLongDateFormate}}</span><br>

                                                            <!-- check due date -->
                                                            <span
                                                                *ngIf="item.activityType == entityEnum.Tasks && item.activityEndDate != null">
                                                                <span class="m-0 font-12"
                                                                    [ngClass]="onCheckDueDate(item.activityDate, item.activityEndDate) ? 'green-text' : 'red-text'">Due
                                                                    Date: </span>
                                                                <span class="font-12"
                                                                    [ngClass]="onCheckDueDate(item.activityDate, item.activityEndDate) ? 'green-text' : 'red-text'">{{
                                                                    item.activityEndDate | dateFormatPipe:
                                                                    _commonHelper.globalLongDateFormateWithoutTime }}</span>
                                                                <br>
                                                            </span>

                                                            <span class="m-0 gray-text font-12">Assign: </span>
                                                            <span class="font-12 pre-text">{{ item.assignedUserName
                                                                }}</span><br>
                                                            <span class="m-0 gray-text font-12">Status: </span>
                                                            <span class="font-12">{{ item.statusName }}</span> <br>

                                                            <p class="mb-0 description-box font-12 pre-text">
                                                                <span class="pre-text">{{ item.description }}</span>
                                                            </p>
                                                            <p class="mb-0 description-box font-12 pre-text">
                                                                <span class="pre-text">{{ item.notes }}</span>
                                                            </p>
                                                        </div>
                                                        <!-- end task status step 1 -->

                                                        <!-- start note step 1 -->
                                                        <div *ngIf="item.activityType == entityEnum.Notes">
                                                            <p class="mb-1 fs13px pr-5">
                                                                <span class="vertical-center flex-nowrap">
                                                                    <strong class="mr-2 font-12 mb-1"
                                                                        id="titleCard">{{'ACTIVITY.NOTE' |
                                                                        translate}}</strong>
                                                                    <i *ngIf="item.isPrivateNote" placement="top top-right"
                                                                        ngbTooltip="This is private note" container="body"
                                                                        aria-hidden="true"
                                                                        class="fas fa-lock cursor-pointer"></i>
                                                                    <i *ngIf="!item.isPrivateNote" placement="top top-right"
                                                                        ngbTooltip="This is public note" container="body"
                                                                        aria-hidden="true"
                                                                        class="fas fa-unlock cursor-pointer"></i>
                                                                    <span class="mb-1 h-21 badge clr-grey p-0 ml-3"
                                                                        *ngIf="item.modified"
                                                                        ngbTooltip=" {{item.modified==null?'':(item.modified | dateFormatPipe: _commonHelper.globalDateFormateWithTime)}} by {{item.modifiedByName}}"
                                                                        placement="top right" container="body"
                                                                        id="badgeActivityEdited">
                                                                        {{'ACTIVITY.NOTES.NOTES_EDITED_BADGE' | translate}}
                                                                        {{item.modified | timeAgoPipe : item.utcModified}}
                                                                    </span>
                                                                </span>
                                                            </p>
                                                            <p *ngIf="item.subject && item.subject != ''"
                                                                class="mb-0 description-box font-12 pre-text">
                                                                <span class="pre-text"><strong>{{ item.subject }}</strong></span>
                                                            </p>
                                                            <p class="mb-0 description-box font-12 pre-text">
                                                                <span class="pre-text">{{ item?.description }}</span>
                                                            </p>
                                                            <p class="mb-0 description-box font-12 pre-text">
                                                                <span class="pre-text">{{ item?.notes }}</span>
                                                            </p>

                                                        </div>
                                                        <!-- end note step 1 -->

                                                        <!-- Activity Stream -->
                                                        <div *ngIf="item.activityType == entityEnum.ActivityStream">
                                                            <p class="mb-1 fs13px pr-5">
                                                                <span class="vertical-center flex-nowrap">
                                                                    <strong class="mr-2 font-12 mb-1" id="titleCard">{{'ACTIVITY.ACTIVITY_STREAM' | translate}}</strong>
                                                                </span>
                                                            </p>
                                                            <p class="mb-0 description-box font-12 pre-text">
                                                                <span [outerHTML]="item.description" class="pre-text"></span>
                                                            </p>
                                                            <p class="mb-0 description-box font-12 pre-text">
                                                                <span [outerHTML]="item.notes" class="pre-text"></span>
                                                            </p>
                                                        </div>
                                                        <!-- end Activity Stream -->

                                                        <div *ngIf="item.activityType == entityEnum.Events">
                                                            <p class="mb-1 fs13px pr-5">
                                                                <span class="font-12 mb-1" id="titleCard">
                                                                    <strong>{{ item.subject }}</strong>
                                                                    <strong *ngIf="item.externalSystem">({{ item.externalSystem }})</strong>
                                                                </span>
                                                                <span class="mb-1 h-23 badge clr-grey p-0 ml-3"
                                                                    *ngIf="item.modified"
                                                                    ngbTooltip=" {{item.modified==null?'':(item.modified | dateFormatPipe: _commonHelper.globalDateFormateWithTime)}} by {{item.modifiedByName}}"
                                                                    placement="top right" container="body"
                                                                    id="badgeActivityEdited">
                                                                    {{'ACTIVITY.APPOINTMENTS.APPOINTMENTS_EDITED_BADGE' | translate}} {{item.modified | timeAgoPipe : item.utcModified}}
                                                                </span>
                                                            </p>
                                                            <span class="m-0 gray-text font-12">{{'ACTIVITY.EVENT_ON' | translate}}:
                                                            </span>
                                                            <span class="font-12">
                                                                {{item.activityDate | dateFormatPipe:_commonHelper.globalLongDateFormate}}
                                                                -
                                                                {{item.activityEndDate | dateFormatPipe:_commonHelper.globalTimeFormate}}
                                                            </span><br>
                                                            <div *ngIf="item.assignedUserName != null">
                                                                <span class="m-0 gray-text font-12">
                                                                    {{'ACTIVITY.OWNER' | translate}}:
                                                                </span>
                                                                <span
                                                                    class="font-12 pre-text">{{item.assignedUserName}}</span><br>
                                                            </div>
                                                            <div *ngIf="item.assignedAttendeesName != null">
                                                                <span class="m-0 gray-text font-12">
                                                                    {{'ACTIVITY.ATTENDEES' | translate}}:
                                                                </span>
                                                                <span
                                                                    class="font-12 pre-text">{{item.assignedAttendeesName}}</span><br>
                                                            </div>
                                                            <div *ngIf="item.description != null" class="d-flex">
                                                                <span class="mr-1 gray-text font-12">
                                                                    {{'ACTIVITY.DESCRIPTION' | translate}}:
                                                                </span>
                                                                <span class="font-12 pre-text description-box" [ngbTooltip]="item.description ? item.description : item.description">
                                                                    {{item.description ? (item.description | characterLimit: _commonHelper.globalTextAreaCharacterLimit) : item.description | characterLimit: _commonHelper.globalTextAreaCharacterLimit }}
                                                                </span><br>
                                                            </div>
                                                            <div *ngIf="item.notes != null" class="d-flex">
                                                                <span class="mr-1 gray-text font-12">
                                                                    {{'ACTIVITY.NOTES_FIELD' | translate}}:
                                                                </span>
                                                                <span class="font-12 pre-text description-box" [ngbTooltip]="item.notes ? item.notes : item.notes">
                                                                    {{item.notes ? (item.notes | characterLimit: _commonHelper.globalTextAreaCharacterLimit) : item.notes | characterLimit: _commonHelper.globalTextAreaCharacterLimit }}
                                                                </span><br>
                                                            </div>

                                                            <!-- start event status -->
                                                            <div class="activity-timeline-link">
                                                                <span class="m-0 gray-text font-12">Status:
                                                                </span>
                                                                <span *ngIf="!item.externalStatus" class="font-12">{{ item.statusName }}</span>
                                                                <span *ngIf="item.externalStatus" class="font-12">{{ item.externalStatus }}</span>
                                                                <span *ngIf='item.statusChangeOn' class="font-12">({{ item.statusChangeOn | dateFormatPipe:_commonHelper.globalLongDateFormate}})
                                                                </span>
                                                            </div>
                                                            <!-- end event status -->
                                                        </div>

                                                        <!-- Tag Start -->
                                                        <div *ngIf="item.activityType == entityEnum.EntityTags">
                                                            <p class="mb-1 fs13px pr-5">
                                                                <span class="pr-3 font-12 mb-1" id="titleCard">
                                                                    <strong>
                                                                        <ng-container
                                                                            *ngIf="item.oprationType && item.oprationType==1">{{'ACTIVITY.TAGS.TAG_ADDED'|
                                                                            translate}}</ng-container>
                                                                        <ng-container
                                                                            *ngIf="item.oprationType && item.oprationType==2">{{'ACTIVITY.TAGS.TAG_DELETED'|
                                                                            translate}}</ng-container>
                                                                        {{ item.subject}}
                                                                    </strong>
                                                                </span>
                                                            </p>
                                                            <span class="m-0 gray-text font-12">
                                                                {{'ACTIVITY.TAGS.TAG_CATEGORY' | translate}}:
                                                            </span>
                                                            <span class="font-12 description-box">
                                                                {{item.description}}
                                                            </span>
                                                            <span class="font-12 description-box">
                                                                {{ item.notes }}
                                                            </span>
                                                        </div>
                                                        <!-- Tag End -->

                                                         <!-- start Entity Review step 1 -->
                                                         <div *ngIf="item.activityType == entityEnum.EntityReviews">
                                                            <p class="mb-1 fs13px pr-5">
                                                                <span class="vertical-center flex-nowrap">
                                                                    <strong class="mr-2 font-12 mb-1" id="titleCard">{{'ACTIVITY.ENTITYREVIEW' | translate | configuredEntityName}}</strong>
                                                                    <span class="mb-1 h-21 badge clr-grey p-0" *ngIf="item.modified"
                                                                        ngbTooltip=" {{item.modified==null?'':(item.modified | dateFormatPipe: _commonHelper.globalDateFormateWithTime)}} by {{item.modifiedByName}}"
                                                                        placement="top right" container="body" id="badgeActivityEdited">
                                                                        {{'ACTIVITY.ENTITYREVIEWS.ENTITYREVIEWS_EDITED_BADGE' | translate | configuredEntityName}}
                                                                        {{item.modified | timeAgoPipe : item.utcModified}}
                                                                    </span>
                                                                </span>
                                                            </p>
                                                            <p *ngIf="item.rating && item.rating != ''" class="mb-0 description-box font-12 pre-text">
                                                                <p-rating [(ngModel)]="item.rating" [readonly]="true" [cancel]="false"></p-rating>
                                                            </p>
                                                            <p class="mb-0 description-box font-12 pre-text">
                                                                <span class="pre-text">{{ item?.description }}</span>
                                                            </p>
                                                        </div>
                                                        <!-- end Entity Review step 1 -->
                                                    </div>
                                                    <div class="float-right">
                                                        <!-- start event status dropdown -->
                                                        <div
                                                            *ngIf="item.activityType == entityEnum.Events && item.statusId">
                                                            <div class="cal-icon dark-grey">
                                                                <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault"
                                                                    class="dropdown drop-no-arrow float-left mr-3">
                                                                    <i class="fas fa-ellipsis-h font-14 dropdown-toggle mr-3 bg-icon-option"
                                                                        id="dropdownMenuNotes" data-bs-toggle="dropdown"
                                                                        aria-expanded="false" aria-haspopup="true"
                                                                        aria-hidden="true">
                                                                    </i>
                                                                    <ul class="dropdown-menu">
                                                                        <li>
                                                                            <a class="dropdown-item menu--item" id="link-event-edit" (click)="onEditEvent(item.id)">
                                                                                <i class="fas fa-pencil-alt pd-menu-icon" aria-hidden="true"></i>
                                                                                {{'ACTIVITY.NOTES.BUTTON_EDIT' | translate}}
                                                                            </a>
                                                                        </li>
                                                                        <li>
                                                                            <a id="link-note-delete"
                                                                                class="dropdown-item menu--item"
                                                                                (click)='onDeleteEvent(item.id)'>
                                                                                <i class="far fa-trash-alt pd-menu-icon"
                                                                                    aria-hidden="true">
                                                                                </i>
                                                                                {{'ACTIVITY.NOTES.BUTTON_DELETE' | translate}}
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                            <div class="cal-icon dark-grey">
                                                                <i class="fas fa-calendar-alt font-12 fa-fw"
                                                                    aria-hidden="true"></i>
                                                            </div>
                                                        </div>
                                                        <!-- end event status dropdown -->

                                                        <!-- start note step 2 -->
                                                        <div *ngIf="item.activityType == entityEnum.Notes"
                                                            class="cal-icon dark-grey">
                                                            <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault"
                                                                class="dropdown drop-no-arrow float-left mr-3">
                                                                <i class="fas fa-ellipsis-h font-14 dropdown-toggle mr-3 bg-icon-option"
                                                                    id="dropdownMenuNotes" data-bs-toggle="dropdown"
                                                                    aria-expanded="false" aria-haspopup="true"
                                                                    aria-hidden="true">
                                                                </i>
                                                                <ul class="dropdown-menu">
                                                                    <li>
                                                                        <a class="dropdown-item menu--item"
                                                                            id="link-note-edit"
                                                                            (click)='onEditNote(item.id)'>
                                                                            <i class="fas fa-pencil-alt pd-menu-icon"
                                                                                aria-hidden="true">
                                                                            </i>
                                                                            {{'ACTIVITY.NOTES.BUTTON_EDIT' | translate}}
                                                                        </a>
                                                                    </li>
                                                                    <li>
                                                                        <a id="link-note-delete"
                                                                            class="dropdown-item menu--item"
                                                                            (click)='onDeleteNote(item.id)'>
                                                                            <i class="far fa-trash-alt pd-menu-icon"
                                                                                aria-hidden="true">
                                                                            </i>
                                                                            {{'ACTIVITY.NOTES.BUTTON_DELETE' | translate}}
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <div *ngIf="item.activityType == entityEnum.Notes"
                                                            class="cal-icon dark-grey">
                                                            <i class="far fa-file dark-grey font-12 fa-fw" aria-hidden="true"></i>
                                                        </div>
                                                        <!-- end note step 2 -->

                                                        <!-- start task-2 -->
                                                        <div *ngIf="item.activityType == entityEnum.Tasks">
                                                            <div *ngIf="_loggedInUser.userId == item.createdBy">
                                                                <div class="cal-icon dark-grey">
                                                                    <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault"
                                                                        class="dropdown drop-no-arrow float-left mr-3">
                                                                        <i class="fas fa-ellipsis-h font-14 dropdown-toggle mr-3 bg-icon-option"
                                                                            id="dropdownMenuNotes" data-bs-toggle="dropdown"
                                                                            aria-expanded="false" aria-haspopup="true"
                                                                            aria-hidden="true">
                                                                        </i>
                                                                        <ul class="dropdown-menu">
                                                                            <li>
                                                                                <a class="dropdown-item menu--item"
                                                                                    id="link-task-edit"
                                                                                    (click)="onEditTask('ACTIVITY', item.id, item.entityRecordTypeID)">
                                                                                    <i class="fas fa-pencil-alt pd-menu-icon"
                                                                                        aria-hidden="true">
                                                                                    </i>
                                                                                    {{'ACTIVITY.NOTES.BUTTON_EDIT' |
                                                                                    translate}}
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="cal-icon dark-grey">
                                                                <i [class]="getTaskClass(item.entityRecordTypeID)" class="fa-fw"
                                                                    aria-hidden="true"></i>
                                                            </div>
                                                        </div>
                                                        <!-- end task-2 -->

                                                        <!-- Tag edit/delete start -->
                                                        <div *ngIf="item.activityType == entityEnum.EntityTags">
                                                            <div class="cal-icon dark-grey">
                                                                <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault && item?.showActionButton"
                                                                    class="dropdown drop-no-arrow float-left mr-3">
                                                                    <i class="fas fa-ellipsis-h font-14 dropdown-toggle mr-3 bg-icon-option"
                                                                        id="dropdownMenuEntityTags"
                                                                        data-bs-toggle="dropdown" aria-expanded="false"
                                                                        aria-haspopup="true" aria-hidden="true">
                                                                    </i>
                                                                    <ul class="dropdown-menu"
                                                                        aria-labelledby="dropdownMenuButton1">
                                                                        <li>
                                                                            <a id="link-tag-delete"
                                                                                class="dropdown-item menu--item"
                                                                                (click)='onDeleteTag(item.id)'>
                                                                                <i class="far fa-trash-alt pd-menu-icon"
                                                                                    aria-hidden="true">
                                                                                </i>
                                                                                {{'ACTIVITY.TAGS.BTN_REMOVE' | translate}}
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                            <div class="cal-icon dark-grey">
                                                                <i class="fas fa-tag dark-grey font-12 fa-fw"
                                                                    aria-hidden="true"></i>
                                                            </div>
                                                        </div>
                                                        <!-- Tag edit/delete end -->

                                                        <!-- start Entity Review step 2 -->
                                                        <div *ngIf="item.activityType == entityEnum.EntityReviews" class="cal-icon dark-grey">
                                                            <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault && item.createdBy == _loggedInUser.userId"
                                                                class="dropdown drop-no-arrow float-left mr-3">
                                                                <i class="fas fa-ellipsis-h font-14 dropdown-toggle mr-3 bg-icon-option"
                                                                    id="dropdownMenuEntityReview" data-bs-toggle="dropdown"
                                                                    aria-expanded="false" aria-haspopup="true"
                                                                    aria-hidden="true">
                                                                </i>
                                                                <ul class="dropdown-menu">
                                                                    <li>
                                                                        <a class="dropdown-item menu--item"
                                                                            id="link-entityReview-edit"
                                                                            (click)='onAddEditEntityReview("Edit", item.id)'>
                                                                            <i class="fas fa-pencil-alt pd-menu-icon"
                                                                                aria-hidden="true">
                                                                            </i>
                                                                            {{'ACTIVITY.ENTITYREVIEWS.BUTTON_EDIT' | translate}}
                                                                        </a>
                                                                    </li>
                                                                    <li>
                                                                        <a id="link-entityReview-delete"
                                                                            class="dropdown-item menu--item"
                                                                            (click)='onDeleteEntityReview(item.id)'>
                                                                            <i class="far fa-trash-alt pd-menu-icon"
                                                                                aria-hidden="true">
                                                                            </i>
                                                                            {{'ACTIVITY.ENTITYREVIEWS.BUTTON_DELETE' | translate}}
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <div *ngIf="item.activityType == entityEnum.EntityReviews"
                                                            class="cal-icon dark-grey">
                                                            <i class="far fa-star dark-grey font-12 fa-fw" aria-hidden="true"></i>
                                                        </div>
                                                        <!-- end Entity Review step 2 -->

                                                        <!-- Activity Stream start -->
                                                        <div *ngIf="item.activityType == entityEnum.ActivityStream"
                                                            class="cal-icon dark-grey">
                                                            <i class="fas fa-history dark-grey font-12 fa-fw"
                                                                aria-hidden="true"></i>
                                                        </div>
                                                        <!-- Activity Stream end -->
                                                    </div>
                                                </div>

                                                <div class="card-body px-3 py-2 border--top--light">
                                                    <div class="active-log-detail vertical-center">
                                                        <div class="vertical-center">
                                                            <ngx-common-user-profile 
                                                                [userId]="item?.createdBy"
                                                                [userTypeId]="userTypeID.CreatedBy"
                                                                [privacyLevel]="privacyLevel"
                                                                [isShowName]="true"
                                                                userLabel="{{'COMMON.COMMON_USER_PROFILE.LABEL_CREATEDBY' | translate | configuredEntityName}}">
                                                                [isItemDisable]="true">
                                                            </ngx-common-user-profile>
                                                        </div>
                                                        <div class="font-12"
                                                            ngbTooltip="{{item.created | dateFormatPipe: _commonHelper.globalDateFormateWithTime }}"
                                                            placement="top top-left" container="body">
                                                            {{ item.created | timeAgoPipe : item.utcCreated }}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="text-center mb-3" *ngIf="activityShowLoadMore">
                                                <a id="btn-event-open" class='btn btn-link p-0'
                                                    (click)="loadActivityData(false)">
                                                    Load More
                                                </a>
                                            </div>
                                            <div class="card mb-3" *ngIf="activityDataSource.length == 0">
                                                <p class="text-center mt-3">
                                                    {{'ACTIVITY.NO_ACTIVITIES_AVAILABLE' | translate}}
                                                </p>
                                            </div>
                                        </div>
                                        <!-- Activity log End-->
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                        <!-- end activity -->

                        <!-- start document -->
                        <ng-container *ngIf="!isHideDocumentTab && onceDocumentTabClicked">
                            <div class="tab-pane fade pt-3 h-100-p" id="documents" role="tabpanel"
                                aria-labelledby="documents" [ngClass]="activeTab === 'documents' ? 'show active': ''"
                                name="documents">
                                <div *ngIf="isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault" class="navTabs h-100-p border-0">
                                    <div class="px-3 pb-3 doc-uploader">
                                        <div class="col-lg-12 p-0">
                                            <!-- start document form -->
                                            <document-form (isDocumentUploadedEmit)="loadDocumentData(true)"
                                                [entityTypeId]="entityTypeId" [entityId]="entityId"
                                                allowedFileType="image,video,audio,pdf,doc,excel,compress,csv">
                                            </document-form>
                                            <!-- end document form -->
                                        </div>
                                    </div>
                                </div>
                                <div class="width--100 flex--center pb-3 px-3 filters-doc-activity">
                                    <div class="d-flex flex-wrap">
                                        <div class="float-left width-filter margin-filter">
                                            <p-dropdown
                                                *ngIf="documentQuickFilterOptions && documentQuickFilterOptions.length > 0"
                                                appendTo="body" panelStyleClass="maxWidthOverride"
                                                [options]="documentQuickFilterOptions" id="drp-documents-duration"
                                                [(ngModel)]="documentQuickFilterSelected" optionLabel="name"
                                                optionValue="strValue1" class="form-control"
                                                (onChange)="loadDocumentData(true)">
                                            </p-dropdown>
                                        </div>
                                        <div class="float-left width-filter margin-filter">
                                            <p-dropdown #entityRecordTypeId="ngModel" appendTo="body"
                                                panelStyleClass="maxWidthOverride"
                                                *ngIf="documentTypeList && documentTypeList.length > 1"
                                                name="entityRecordTypeId" [(ngModel)]="documentModel.entityRecordTypeId"
                                                [options]="documentTypeList" id="drp-documents-type" optionLabel="label"
                                                optionValue="value" (onChange)="loadDocumentData(true)"></p-dropdown>
                                        </div>
                                    </div>
                                    <span>
                                        <i class="fas fa-sync-alt fa-lg dark-grey cursor-pointer" aria-hidden="true"
                                            id="btn-refresh-documents" (click)="loadDocumentData(true)"></i>
                                    </span>
                                </div>
                                <!-- Quick Filter Duration End -->

                                <!-- Document list start -->
                                <div class="ht-card mx-3 mb-card-documents ht-documents">
                                    <div class="card card-data" id="log-documents" *ngFor="let item of documentDataSource">
                                        <div class="card-body d-flex p-3">
                                            <div class="float-left w-100">
                                                <div class="vertical-center justify-content-between">
                                                    <p class="mb-1 float-left text--inline">
                                                        <i [ngClass]="item.iconName" [ngbTooltip]="item.name | getFileNameOrExtensionPipe: true" placement="top auto" container="body" class="font-14 mr-2" aria-hidden="true"></i>
                                                        <a (click)='viewDocument(item.id)'
                                                            class="mr-2 text--full cursor-pointer dark-blue"><span>{{ item.name | getFileNameOrExtensionPipe }}</span>
                                                        </a>
                                                        <i *ngIf="item.isPrivate" placement="top top-right"
                                                            ngbTooltip="This is private document" container="body"
                                                            aria-hidden="true" class="fas fa-lock cursor-pointer">
                                                        </i>
                                                        <i *ngIf="!item.isPrivate" placement="top top-right"
                                                            ngbTooltip="This is public document" container="body"
                                                            aria-hidden="true" class="fas fa-unlock cursor-pointer">
                                                        </i>
                                                    </p>
                                                    <div *ngIf="(isEditPermission && isActive && !isPaused && !isClosedStage && !isCompletedStage && !isDefault) || isDocumentDownloadPermission"
                                                        class="grid-dropdown dropdown drop-no-arrow">
                                                        <i class="fas fa-ellipsis-h font-14 dropdown-toggle bg-icon-option"
                                                            id="dropdownMenuDocument" data-bs-toggle="dropdown"
                                                            aria-expanded="false" aria-haspopup="true" aria-hidden="true">
                                                        </i>
                                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                                            <li *ngIf="isDocumentDownloadPermission">
                                                                <a class="dropdown-item menu--item" id="link-doc-download"
                                                                    (click)='downloadDocument(item.id)'>
                                                                    <i class="fas fa-download pd-menu-icon"
                                                                        id="icon-download" aria-hidden="true">
                                                                    </i>
                                                                    {{'DOCUMENTS.DOWNLOAD' | translate}}
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="dropdown-item menu--item" id="link-doc-edit"
                                                                    (click)='openDocumentDialog(item.id)'>
                                                                    <i class="fas fa-pencil-alt pd-menu-icon"
                                                                        aria-hidden="true">
                                                                    </i>
                                                                    {{'ACTIVITY.NOTES.BUTTON_EDIT' | translate}}
                                                                </a>
                                                            </li>
                                                            <li *ngIf="item.canDelete">
                                                                <a id="link-doc-delete" class="dropdown-item menu--item"
                                                                    (click)='deleteDocument(item.id)'>
                                                                    <i class="far fa-trash-alt pd-menu-icon"
                                                                        aria-hidden="true">
                                                                    </i>
                                                                    {{'ACTIVITY.NOTES.BUTTON_DELETE' | translate}}
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <span id="badgeEntityRecordType"
                                                    class="h-21 badge badge-primary badge--status mb-2">{{item.entityRecordTypeName}}</span>
                                                <p class="mb-0 description-box">
                                                    <span>{{ item.description }}</span>
                                                </p>
                                                <p class="mb-0 description-box">
                                                    <span>{{ item.notes }}</span>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="card-body px-3 py-2 border--top--light">
                                            <div class="active-log-detail vertical-center">
                                                <div class="vertical-center">
                                                            <ngx-common-user-profile 
                                                                [userId]="item?.createdBy"
                                                                [userTypeId]="userTypeID.CreatedBy"
                                                                [privacyLevel]="privacyLevel"
                                                                [isItemDisable]="true"
                                                                [isShowName]="true" 
                                                                userLabel="{{'COMMON.COMMON_USER_PROFILE.LABEL_CREATEDBY' | translate | configuredEntityName}}">>
                                                            </ngx-common-user-profile>
                                                </div>
                                                <div class="font-12">
                                                    {{ item.created | timeAgoPipe : item.utcCreated }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mb-3"
                                        *ngIf="documentDataSource.length > 0 && documentShowLoadMore">
                                        <a class='btn btn-link p-0' (click)="loadDocumentData(false)">
                                            Load More
                                        </a>
                                    </div>
                                    <div class="card mb-3" *ngIf="documentDataSource.length == 0">
                                        <p class="text-center mt-3">
                                            {{'DOCUMENTS.NO_DOCUMENTS_AVAILABLE' | translate}}</p>
                                    </div>
                                </div>
                                <!-- Document list end-->
                            </div>
                        </ng-container>

                        <!-- end document -->
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</div>